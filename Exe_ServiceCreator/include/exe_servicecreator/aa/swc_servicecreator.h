///////////////////////////////////////////////////////////////////////////////////////////////////////////
///                                                                                                        
/// Copyright, 2021 PopcornSAR Co., Ltd. All rights reserved.                                              
/// This software is copyright protected and proprietary to PopcornSAR Co., Ltd.                           
/// PopcornSAR Co., Ltd. grants to you only those rights as set out in the license conditions.             
///                                                                                                        
///////////////////////////////////////////////////////////////////////////////////////////////////////////
/// AUTOSAR VERSION                   : R20-11
/// GENERATED BY                      : PARA, Adaptive Application Generator
///////////////////////////////////////////////////////////////////////////////////////////////////////////
/// GENERATED FILE NAME               : swc_servicecreator.h
/// SOFTWARE COMPONENT NAME           : Swc_ServiceCreator
/// GENERATED DATE                    : 2025-12-12 16:18:09
///////////////////////////////////////////////////////////////////////////////////////////////////////////
#ifndef PARA_AA_GEN_SOFTWARE_COMPONENT_EXE_SERVICECREATOR_AA_H
#define PARA_AA_GEN_SOFTWARE_COMPONENT_EXE_SERVICECREATOR_AA_H
///////////////////////////////////////////////////////////////////////////////////////////////////////////
/// INCLUSION HEADER FILES
///////////////////////////////////////////////////////////////////////////////////////////////////////////
#include "exe_servicecreator/aa/port/pport_scr2bpp.h"
#include "exe_servicecreator/aa/port/pport_scr2bvp.h"
#include "exe_servicecreator/aa/port/pport_scr2cg.h"
#include "exe_servicecreator/aa/port/pport_scr2ebs.h"
#include "exe_servicecreator/aa/port/pport_scr2evls.h"
#include "exe_servicecreator/aa/port/pport_scr2fp.h"
#include "exe_servicecreator/aa/port/pport_scr2gpv.h"
#include "exe_servicecreator/aa/port/pport_scr2mp.h"
#include "exe_servicecreator/aa/port/pport_scr2mvp.h"
#include "exe_servicecreator/aa/port/pport_scr2ocp.h"
#include "exe_servicecreator/aa/port/pport_scr2pe.h"
#include "exe_servicecreator/aa/port/pport_scr2po.h"
#include "exe_servicecreator/aa/port/pport_scr2pv.h"
#include "exe_servicecreator/aa/port/pport_scr2rs.h"
#include "exe_servicecreator/aa/port/pport_scr2ss.h"
#include "exe_servicecreator/aa/port/pport_scr2vs.h"
#include "exe_servicecreator/aa/port/rport_mp2scr.h"
#include "exe_servicecreator/aa/port/rport_pv2scr.h"
#include "exe_servicecreator/aa/port/rport_ocp2scr.h"
 
#include "ara/log/logger.h"
#include "para/swc/port_pool.h"

#include <thread>
#include <cstdint>
#include <mutex>
#include <atomic>
#include <fstream>
#include <memory>
#include <unordered_map>
#include <nlohmann/json.hpp>

// Socket constants
#define SOCKET_SERVER_IP "192.168.100.95"
#define SOCKET_SERVER_PORT 9000
#define SOCKET_BUFFER_SIZE 4096
 
namespace exe_servicecreator
{
namespace aa
{
 
class Swc_ServiceCreator
{
public:
    /// @brief Constructor
    Swc_ServiceCreator();
    
    /// @brief Destructor
    ~Swc_ServiceCreator();
    
    /// @brief Initialize software component
    bool Initialize();
    
    /// @brief Start software component
    void Start();
    
    /// @brief Terminate software component
    void Terminate();
    
    /// @brief Run software component
    void Run();
    
private:
    /// @brief Running status of software component
    bool m_running;
    
    /// @brief Pool of port
    ::para::swc::PortPool m_workers;
    
    /// @brief Logger for software component
    ara::log::Logger& m_logger;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2BPP}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2BPP> m_PPort_SCr2BPP;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2BVP}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2BVP> m_PPort_SCr2BVP;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2CG}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2CG> m_PPort_SCr2CG;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2EBS}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2EBS> m_PPort_SCr2EBS;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2EVLS}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2EVLS> m_PPort_SCr2EVLS;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2FP}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2FP> m_PPort_SCr2FP;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2GPV}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2GPV> m_PPort_SCr2GPV;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2MP}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2MP> m_PPort_SCr2MP;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2MVP}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2MVP> m_PPort_SCr2MVP;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2OCP}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2OCP> m_PPort_SCr2OCP;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2PE}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2PE> m_PPort_SCr2PE;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2PO}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2PO> m_PPort_SCr2PO;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2PV}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2PV> m_PPort_SCr2PV;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2RS}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2RS> m_PPort_SCr2RS;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2SS}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2SS> m_PPort_SCr2SS;
    
    /// @brief Instance of Port {Swc_ServiceCreator.PPort_SCr2VS}
    std::unique_ptr<exe_servicecreator::aa::port::PPort_SCr2VS> m_PPort_SCr2VS;
    
    /// @brief Instance of Port {Swc_ServiceCreator.RPort_MP2SCr}
    std::unique_ptr<exe_servicecreator::aa::port::RPort_MP2SCr> m_RPort_MP2SCr;
    
    /// @brief Instance of Port {Swc_ServiceCreator.RPort_PV2SCr}
    std::unique_ptr<exe_servicecreator::aa::port::RPort_PV2SCr> m_RPort_PV2SCr;
    
    /// @brief Instance of Port {Swc_ServiceCreator.RPort_OCP2SCr}
    std::unique_ptr<exe_servicecreator::aa::port::RPort_OCP2SCr> m_RPort_OCP2SCr;
    
    /// @brief Socket-related members
    int m_socket_fd;
    std::thread m_socket_thread;
    std::thread m_socket_conn_thread;
    bool m_socket_running;
    std::atomic<bool> m_socket_connected;
    std::mutex m_socket_mutex;
    
    /// @brief Socket methods
    bool ConnectToSocketServer();
    void SocketReceiveThread();
    void SocketConnectLoop();
    void CloseSocketConnection();
    
    /// @brief Trajectory JSONL writing members
    std::uint8_t m_current_scenario_id{0};
    bool m_scenario_active{false};
    std::unordered_map<std::uint8_t, std::uint32_t> m_scenario_counts;
    std::unique_ptr<std::ofstream> m_jsonl_output_file;
    std::mutex m_jsonl_mutex;
    
    /// @brief Trajectory to JSON conversion
    nlohmann::json trajectoryToJson(const oss::srv::OCP2SCr::proxy::events::trajectory::SampleType& traj);

    /// @brief Send plain text message over socket (if connected)
    void SendSocketMessage(const std::string& message);
};
 
} /// namespace aa
} /// namespace exe_servicecreator
 
#endif /// PARA_AA_GEN_SOFTWARE_COMPONENT_EXE_SERVICECREATOR_AA_H